<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>{{ location[1] }} | Inclusi-Rate</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet">
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />

  <style>
    @import url('https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600&display=swap');
    
    body {
      background-color: #f0f2f5;
      font-family: 'Poppins', sans-serif;
      color: #2d3436;
    }

    .container {
      max-width: 800px;
    }

    .review-card {
      background: #ffffff;
      border-radius: 16px;
      padding: 20px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
      margin-bottom: 20px;
      transition: transform 0.3s ease;
    }

    .review-card:hover {
      transform: translateY(-2px);
    }

    #map {
      height: 300px;
      border-radius: 16px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }

    textarea, input {
      resize: none;
      border-radius: 8px;
      border: 1px solid #dfe6e9;
    }

    textarea:focus, input:focus {
      border-color: #0984e3;
      box-shadow: 0 0 0 0.25rem rgba(9, 132, 227, 0.25);
    }

    h1, h2 {
      color: #0984e3;
    }

    .btn-success {
      background-color: #00b894;
      border: none;
      padding: 10px 24px;
      transition: all 0.3s ease;
    }

    .btn-success:hover {
      background-color: #00a383;
      transform: translateY(-2px);
    }

    /* Modern Star Rating */
    .rating-container {
      display: flex;
      flex-direction: column;
      gap: 8px;
    }
    
    .rating-label {
      font-weight: 500;
      color: #2d3436;
    }
    
    .star-rating {
      display: flex;
      gap: 4px;
      align-items: center;
    }
    
    .star-rating input {
      display: none;
    }
    
    .star-rating label {
      cursor: pointer;
      font-size: 2rem;
      color: #dfe6e9;
      transition: all 0.2s ease;
      position: relative;
    }
    
    .star-rating label:before {
      content: '★';
      display: block;
    }
    
    .star-rating input:checked ~ label,
    .star-rating input:focus ~ label,
    .star-rating label:hover,
    .star-rating input:hover ~ label {
      color: #ffc107;
      transform: scale(1.1);
    }
    
    .star-rating input:checked + label {
      animation: bounce 0.5s;
    }
    
    @keyframes bounce {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.3); }
    }
    
    .rating-hint {
      font-size: 0.9rem;
      color: #636e72;
      margin-left: 8px;
    }

    .text-muted {
      color: #636e72 !important;
    }
  </style>
</head>
<body>
  <div class="container mt-5 mb-5">
    <h1 class="mb-3">{{ location[1] }}</h1>
    <p class="text-muted">
      <strong>Address:</strong> {{ location[2] }}<br>
      <strong>Average Rating:</strong> {{ location[3] }}<br>
      {% if location[4] %}<strong>Description:</strong> {{ location[4] }}{% endif %}
    </p>

    <hr>

    <h2 class="mt-4 mb-3">Accessibility Reviews</h2>

    {% for review in reviews %}
    <div class="review-card" role="article" aria-label="Accessibility review with rating {{ review.rating }}">
      <p class="mb-1"><strong>Rating:</strong> 
        {% set rating = review.rating | int %}
        {{ '★' * rating }}{{ '☆' * (5 - rating) }}
      </p>
      <p class="mb-0">{{ review.comment }}</p>
    </div>
    {% endfor %}

    <hr>
    <h2 class="mt-5 mb-3">Suggested Wheelchair-Friendly Places (AI-Generated by Gemini)</h2>
<p class="text-muted">These suggestions are based on AI knowledge and may not be real-time—verify details.</p>
{% if gemini_suggestions %}
  {% for place in gemini_suggestions %}
    <div class="review-card" role="article" aria-label="Suggested place: {{ place.name }}">
      <h5>{{ place.name }}</h5>
      <p><strong>Address:</strong> {{ place.address }}</p>
      <p><strong>Rating:</strong> {{ place.rating }}</p>
      <p><strong>Distance:</strong> {{ place.distance }} km</p>
      <p><strong>Opening Hours:</strong> {{ place.opening_hours or 'N/A' }}</p>
      <p><strong>Phone:</strong> {{ place.phone or 'N/A' }}</p>
      <p><strong>Top Review:</strong> {{ place.top_review }}</p>
    </div>
  {% endfor %}
{% else %}
  <p>No suggestions available.</p>
{% endif %}
    <hr>
    <h2 class="mt-5 mb-3">Add a Review</h2>
    <form action="/add_review" method="post" aria-label="Add an accessibility review">
      <input type="hidden" name="location_id" value="{{ location[0] }}">
      
      <div class="mb-3">
        <label for="comment" class="form-label">Your Experience</label>
        <textarea class="form-control" name="comment" id="comment" rows="3" placeholder="Describe accessibility features or issues..." required></textarea>
      </div>

      <div class="rating-container mb-4">
        <span class="rating-label">Rate this location</span>
        <div class="star-rating">
          <input type="radio" id="5-stars" name="rating" value="5" required>
          <label for="5-stars" title="Excellent"></label>
          <input type="radio" id="4-stars" name="rating" value="4">
          <label for="4-stars" title="Good"></label>
          <input type="radio" id="3-stars" name="rating" value="3">
          <label for="3-stars" title="Average"></label>
          <input type="radio" id="2-stars" name="rating" value="2">
          <label for="2-stars" title="Poor"></label>
          <input type="radio" id="1-star" name="rating" value="1">
          <label for="1-star" title="Terrible"></label>
          <span class="rating-hint">(1-5 stars)</span>
        </div>
      </div>

      <button type="submit" class="btn btn-success btn-lg">Submit Review</button>
    </form>

    <hr class="my-5">

    <h2>Map</h2>
    <div id="map" class="mb-5"></div>
  </div>

  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const lat = {{ location[5]|default(40.7128) }};
    const lng = {{ location[6]|default(-74.0060) }};

    const map = L.map('map').setView([lat, lng], 13); 

    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    L.marker([lat, lng]).addTo(map)
      .bindPopup("{{ location[1] }}<br>{{ location[2] }}")
      .openPopup();
  </script>
  
  <!-- Accessibility Controls -->
  <div class="text-center mt-4 mb-5" role="region" aria-label="Accessibility options">
    <button onclick="changeFontSize(1.1)" class="btn btn-outline-secondary" aria-label="Increase text size">A+</button>
    <button onclick="changeFontSize(0.9)" class="btn btn-outline-secondary" aria-label="Decrease text size">A-</button>
    <button onclick="resetFontSize()" class="btn btn-outline-secondary" aria-label="Reset text size">Reset</button>
  </div>

  <script>
    let currentFontSize = 1;

    function changeFontSize(factor) {
      currentFontSize *= factor;
      document.body.style.fontSize = `${currentFontSize}em`;
      document.body.style.transition = 'font-size 0.3s ease';
    }

    function resetFontSize() {
      currentFontSize = 1;
      document.body.style.fontSize = '1em';
    }
  </script>
</body>
</html>
